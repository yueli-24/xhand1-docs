#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import re

# 读取docs.ts文件
with open('client/src/lib/docs.ts', 'r', encoding='utf-8') as f:
    content = f.read()

# 新的快速入门章节内容
new_quickstart_sections = {
    "unboxing": '''# 开箱与安全须知

## 开箱检查

收到XHAND1灵巧手后，请按照以下步骤进行开箱检查：

### 包装清单

打开包装箱，确认以下物品齐全：

| 物品 | 数量 | 说明 |
|------|------|------|
| XHAND1灵巧手本体 | 1个 | 左手或右手（根据订单） |
| 电源适配器 | 1个 | 24V直流电源 |
| XH04通讯调试线 | 1根 | 包含USB和RJ45接口 |
| 安装螺钉包 | 1套 | M3螺钉×8 |
| 产品使用手册 | 1份 | 纸质或电子版 |
| 产品合格证 | 1份 | 质量检验证明 |

### 外观检查

仔细检查灵巧手本体，确保：

1. **外壳完整**：无明显划痕、裂纹或变形
2. **关节灵活**：手动轻轻活动各个关节，应无卡滞现象
3. **接口完好**：电气接口无损坏，引脚无弯曲
4. **线缆完整**：通讯线缆无破损，接头无松动

如发现任何异常，请立即联系售后服务：support@robotera.com

## 安全须知

在使用XHAND1之前，请务必阅读并遵守以下安全注意事项：

### 电气安全

1. **使用指定电源**：仅使用随机配备的24V直流电源适配器，切勿使用其他电源
2. **防止短路**：在连接电源前，确保所有接口干燥、清洁，无异物
3. **断电操作**：在进行机械安装或维护时，务必先断开电源
4. **接地保护**：确保设备外壳良好接地，防止静电损坏

### 机械安全

1. **防止夹伤**：灵巧手运动时，请勿将手指或其他物体伸入关节之间
2. **负载限制**：不要超过额定负载（单指1.2kg，整手4.8kg），避免损坏电机
3. **安装牢固**：使用8个M3螺钉将灵巧手牢固安装至机械臂或测试台，防止脱落
4. **工作空间**：确保灵巧手周围有足够的活动空间，避免碰撞

### 环境要求

1. **工作温度**：0°C ~ 45°C
2. **存储温度**：-20°C ~ 60°C
3. **湿度范围**：20% ~ 80% RH（无凝露）
4. **防护等级**：IP20，避免水溅、灰尘过多的环境

### 操作安全

1. **首次使用**：首次使用前，务必进行设备标定（如需要）
2. **紧急停止**：在上位机软件中设置紧急停止按钮，遇到异常立即停止
3. **监督操作**：初次使用时，建议在专业人员监督下进行
4. **定期检查**：定期检查螺钉紧固情况、线缆连接状态

## 存储建议

如需长期存储XHAND1，请注意：

1. **断开电源**：拔除所有电源和通讯线缆
2. **防尘保护**：使用防尘袋或原包装箱存放
3. **环境控制**：存放在干燥、阴凉、通风良好的环境中
4. **定期检查**：每3个月取出检查一次，轻轻活动关节，防止润滑油固化''',

    "host-software": '''# 上位机软件使用

XHAND1 配备专用的上位机软件 **XOS（XHAND Operating System）**，提供图形化界面进行设备连接、调试、标定和数据监控。

## 系统要求

### 操作系统

- **推荐系统**：Ubuntu 20.04 LTS (Focal Fossa)
- **其他支持**：Ubuntu 18.04 / 22.04 也可使用，但推荐20.04以获得最佳兼容性

### 硬件要求

| 组件 | 最低要求 | 推荐配置 |
|------|---------|---------|
| **CPU** | Intel i5-12400 | Intel i7-12700 或更高 |
| **内存** | 8GB | 16GB 或更高 |
| **硬盘** | 128GB SSD | 256GB SSD 或更大 |
| **USB接口** | USB 2.0 | USB 3.0 |
| **网口** | 千兆以太网口 | 千兆以太网口 |

### 浏览器要求

- **推荐浏览器**：Google Chrome（谷歌浏览器）
- **最低版本**：130.0.6723.69（正式版本）64位
- **其他支持**：Chromium、Microsoft Edge（Chromium内核）

## 软件安装

### 步骤1：下载安装包

访问官方下载地址获取最新版本的XHand上位机软件：

**下载地址**：[https://di6kz6gamrw.feishu.cn/drive/folder/WGyhflqb1lRu9ddtc0scjDhwngg](https://di6kz6gamrw.feishu.cn/drive/folder/WGyhflqb1lRu9ddtc0scjDhwngg)

下载文件名格式：`xhand_v1.x.x.deb`

### 步骤2：安装前置依赖

首次安装需要联网安装前置依赖。打开终端，依次执行以下命令：

#### 安装 JDK（Java开发工具包）

需要JDK版本大于等于8，建议在8-17之间：

```bash
sudo apt-get update
sudo apt-get install -y openjdk-8-jdk
```

#### 安装 Python 和 pip3

```bash
sudo apt-get install -y python3-pip
```

#### 安装 Boost 文件系统库

```bash
sudo apt install libboost-filesystem-dev -y
```

#### 安装 pybind11（版本相关）

**注意**：上位机版本 **≥ v1.1.7** 的用户**不需要**执行此命令

```bash
sudo pip3 install pybind11
```

#### 安装 nlohmann-json3-dev（版本相关）

**注意**：上位机版本 **≥ v1.1.10** 的用户**需要**执行此命令

```bash
sudo apt install -y nlohmann-json3-dev
```

### 步骤3：验证安装

执行以下命令验证依赖是否安装成功：

```bash
# 验证 Java
$ java -version
openjdk version "1.8.0_422"
OpenJDK Runtime Environment (build 1.8.0_422-8u422-b05-1~20.04-b05)
OpenJDK 64-Bit Server VM (build 25.422-b05, mixed mode)

# 验证 Python
$ python3 --version
Python 3.8.10

# 验证 pip3
$ pip3 --version
pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8)

# 验证 Boost
$ dpkg -l | grep libboost-filesystem-dev
ii libboost-filesystem-dev:amd64 1.71.0.0ubuntu2 amd64
```

### 步骤4：安装 XHand 软件

使用 `dpkg` 命令安装下载的 `.deb` 安装包：

```bash
# 进入下载目录
cd ~/Downloads

# 安装 XHand 软件
sudo dpkg -i xhand_v1.x.x.deb
```

**重要提示**：
- 请在**普通用户权限**下进行安装
- **不支持** root 权限及免密权限用户下安装
- 如需卸载，执行：`sudo dpkg -r xhand`

安装完成后，系统内会增加 **XHAND** 应用图标。

## 设备连接

### 硬件连接步骤

#### 1. 连接电源

将随机配备的24V电源适配器连接到XHAND1的电源接口。确保电源指示灯亮起（如有）。

#### 2. 连接通讯线缆

使用 **XH04 通讯调试线** 连接灵巧手与电脑。XH04线缆提供两种接口：

- **USB 接口**：用于 **RS485 通讯协议**
- **RJ45 接口**：用于 **EtherCAT 通讯协议**

**注意**：两种接口**只需连接一个**，根据您的通讯协议需求选择：

| 通讯协议 | 接口类型 | 适用场景 |
|---------|---------|---------|
| **EtherCAT** | RJ45（网线接口） | 实时控制，低延迟（推荐） |
| **RS485** | USB接口 | 非实时控制，调试测试 |

#### 3. 连接示意图

参考以下连接方式：

```
[电脑] ←→ [XH04通讯线] ←→ [XHAND1灵巧手] ←→ [电源适配器] ←→ [220V插座]
        USB或RJ45              电源接口
```

### 软件连接步骤

#### 1. 启动 XOS 应用

双击桌面或应用菜单中的 **【XHAND】** 图标，启动上位机软件。

等待约10秒，系统会弹出密码输入框，输入您的系统密码后，浏览器会自动打开并显示 XOS 界面。

#### 2. 搜索并连接设备

在 XOS 主界面中：

1. 点击 **【搜索连接】** 按钮
2. 在弹出的对话框中，选择通讯协议：
   - 如果使用 RJ45 接口，选择 **【EtherCAT】**
   - 如果使用 USB 接口，选择 **【RS485】**
3. 点击 **【确定】**
4. 系统会自动读取设备 ID，选择检测到的设备
5. 再次点击 **【确定】** 完成连接

#### 3. 连接成功

连接成功后，XOS 会自动跳转到主界面，显示灵巧手的实时状态信息。

## 常见连接问题

### 问题1：搜索不到设备

**可能原因**：
- 通讯线缆未正确连接
- 电源未接通
- 通讯协议选择错误（EtherCAT/RS485不匹配）

**解决方法**：
1. 检查所有线缆连接是否牢固
2. 确认电源适配器已插入并通电
3. 确认通讯协议选择与实际接口一致

### 问题2：连接后无响应

**可能原因**：
- 设备 ID 冲突
- 驱动程序未正确安装

**解决方法**：
1. 重启 XOS 应用
2. 检查系统日志：`journalctl -u xhand`
3. 联系技术支持：support@robotera.com''',

    "first-test": '''# 第一次测试运行

完成设备连接后，建议进行以下测试以确保XHAND1工作正常。

## 主页展示

连接成功后，XOS 主界面会显示以下信息：

### 设备基本信息

- **设备型号**：2L32（左手）或 2R32（右手）
- **设备 ID**：当前连接的设备编号
- **固件版本**：灵巧手的固件版本号
- **通讯协议**：EtherCAT 或 RS485

### 实时数据监控

主界面提供以下实时数据的可视化展示：

1. **关节角度**：12个关节的当前角度值，以手指图形和数值表格形式显示
2. **电流监控**：各关节电机的实时电流，用于监控负载情况
3. **扭矩反馈**：各关节的实时扭矩值
4. **触觉数据**：5个指尖触觉传感器的综合力值（如配备触觉传感器）

### 触觉传感器操作

如果您的XHAND1配备了触觉传感器：

1. **查看触觉数据**：当灵巧手抓握物体时，主页会实时显示各指尖的触觉综合力值
2. **传感器清零**：松开物体后，合力值可能仍显示残留数据，点击 **【传感器清零】** 按钮进行归零操作

## 设备调试

### 测试设备联动状态

点击侧边栏的 **【调试设备】** 菜单项，进入设备调试界面。

在此界面中，您可以：

1. **测试连接状态**：确认灵巧手是否处于联动状态
2. **查看关节状态**：检查所有关节是否正常响应
3. **检测异常**：系统会自动检测并提示异常关节

### 位置模式测试

在调试界面中，切换到 **【位置模式】**：

1. **拖动滑块**：每个关节对应一个滑块，拖动滑块可控制关节角度
2. **观察运动**：观察灵巧手是否按照指令运动
3. **检查范围**：测试各关节是否能达到规格表中的运动范围
4. **听声音**：正常运行时应平稳安静，如有异常噪音请停止测试

### 测试建议

首次测试时，建议按以下顺序进行：

1. **单关节测试**：逐个关节进行小幅度运动测试
2. **组合测试**：测试同一手指的多个关节协同运动
3. **整手测试**：测试所有关节的协调运动
4. **抓握测试**：尝试抓取轻质物体（如海绵块）

## 设备标定（可选）

### 何时需要标定

在以下情况下，需要对XHAND1进行标定：

1. **首次使用**：如果灵巧手初始化位置不在默认零位
2. **运输后**：长途运输后可能导致零位偏移
3. **维修后**：更换关节或电机后
4. **异常情况**：发现关节角度显示与实际位置不符

### 标定步骤

**重要提示**：大多数情况下，XHAND1出厂时已完成标定，**默认不需要**重新标定。

如确需标定，请按以下步骤操作：

#### 1. 准备标定模具

XHAND1 随机配备标定模具（如有），将灵巧手放入标定模具内，确保：

- 所有手指完全伸展
- 各关节处于标准零位姿态
- 手掌平稳放置，无倾斜

#### 2. 执行标定程序

在 XOS 界面中：

1. 点击侧边栏的 **【标定】** 菜单项
2. 确认灵巧手已放入标定模具
3. 点击 **【开始标定】** 按钮
4. 等待标定程序自动执行（约30秒）

#### 3. 标定完成

标定完成后，XOS 会弹窗提示 **"标定成功"**。此时可以取出灵巧手，正常使用。

### 标定注意事项

- 标定过程中**不要**移动灵巧手
- 标定过程中**不要**断开电源或通讯线缆
- 如标定失败，请检查模具放置是否正确，重新尝试
- 如多次标定失败，请联系技术支持

## 第一次抓取测试

完成以上测试后，可以尝试进行第一次抓取测试：

### 测试物体选择

首次测试建议使用以下物体：

- **海绵块**：柔软，不易损坏灵巧手
- **网球**：大小适中，易于抓握
- **塑料瓶**：轻质，形状规则

**避免使用**：
- 尖锐物体（可能损坏触觉传感器）
- 过重物体（超过额定负载）
- 易碎物品（首次测试可能控制不当）

### 抓取步骤

1. **放置物体**：将测试物体放置在灵巧手前方
2. **打开手指**：在位置模式下，将所有手指打开至最大角度
3. **靠近物体**：移动机械臂（或手动）使灵巧手靠近物体
4. **闭合手指**：逐渐拖动滑块，使手指闭合抓握物体
5. **观察触觉**：如有触觉传感器，观察触觉数据变化
6. **提起物体**：确认抓握牢固后，提起物体
7. **松开物体**：打开手指，释放物体

### 测试成功标志

如果以下条件都满足，说明XHAND1工作正常：

- ✅ 所有关节运动流畅，无卡顿
- ✅ 能够稳定抓握测试物体
- ✅ 触觉传感器数据正常显示（如有）
- ✅ 无异常声音或发热
- ✅ 上位机软件数据显示正常

## 下一步

完成第一次测试后，您可以：

1. **学习 SDK 开发**：参考 [SDK 开发指南](/docs/sdk/overview) 进行编程控制
2. **尝试遥操作**：参考 [遥操作指南](/docs/teleoperation/overview) 使用VR设备控制
3. **探索应用案例**：参考 [应用实践](/docs/applications/grasping) 了解更多使用场景

如遇到任何问题，请访问 [常见问题FAQ](/docs/faq) 或联系技术支持。'''
}

# 使用正则表达式替换快速入门章节的内容
for section_id, new_content in new_quickstart_sections.items():
    pattern = rf'(id: "{section_id}",\s+title: "[^"]+",\s+path: "/docs/quickstart/{section_id}",\s+content: `)([^`]+)(`)'
    content = re.sub(pattern, r'\1' + new_content + r'\3', content, flags=re.DOTALL)

# 写回文件
with open('client/src/lib/docs.ts', 'w', encoding='utf-8') as f:
    f.write(content)

print("快速入门章节更新完成！")
